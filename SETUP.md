# –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—é MVP

## ‚úÖ –©–æ –≤–∂–µ –ø—Ä–∞—Ü—é—î

MVP –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **AWS S3** –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤.

---

## üìã –ö—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫—É

### 1. –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é –ë–î

```bash
cd file-storage-app

# –í–∞—Ä—ñ–∞–Ω—Ç 1: –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —ñ—Å–Ω—É—é—á—É –º—ñ–≥—Ä–∞—Ü—ñ—é
npx prisma migrate deploy

# –í–∞—Ä—ñ–∞–Ω—Ç 2: –î–ª—è dev - —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ —Å—Ö–µ–º—É (–±–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ—ó)
npx prisma db push

# –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ Prisma Client (—è–∫—â–æ —â–µ –Ω–µ –∑—Ä–æ–±–ª–µ–Ω–æ)
npx prisma generate
```

### 2. –î–æ–¥–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è

–î–æ–¥–∞–π –¥–æ —Ñ–∞–π–ª—É `.env` (–≤ –∫–æ—Ä–µ–Ω—ñ `file-storage-app/`):

```env
# –Ü—Å–Ω—É—é—á—ñ –∑–º—ñ–Ω–Ω—ñ (—è–∫—â–æ —î)
DATABASE_URL="postgresql://..."
AUTH_SECRET="–º—ñ–Ω—ñ–º—É–º-32-—Å–∏–º–≤–æ–ª–∏-–∞–±–æ-–±—ñ–ª—å—à–µ"

# AWS S3 Storage (–æ–±–æ–≤'—è–∑–∫–æ–≤—ñ)
S3_REGION="us-east-1"  # –≤–∞—à AWS —Ä–µ–≥—ñ–æ–Ω (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: us-east-1, eu-west-1)
S3_BUCKET="your-bucket-name"
S3_ACCESS_KEY_ID="your-aws-access-key-id"
S3_SECRET_ACCESS_KEY="your-aws-secret-access-key"

# –§–∞–π–ª–æ–≤–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è (–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)
FILE_ENCRYPTION_KEY="–º—ñ–Ω—ñ–º—É–º-32-—Å–∏–º–≤–æ–ª–∏-–≤–∏–ø–∞–¥–∫–æ–≤–∏–π-–∫–ª—é—á-–¥–ª—è-—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è-—Ñ–∞–π–ª—ñ–≤"
```

**–í–∞–∂–ª–∏–≤–æ:** `FILE_ENCRYPTION_KEY` –º–∞—î –±—É—Ç–∏ **–º—ñ–Ω—ñ–º—É–º 32 —Å–∏–º–≤–æ–ª–∏**. –¶–µ master key –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–ª—é—á—ñ–≤ —Ñ–∞–π–ª—ñ–≤.

–ü—Ä–∏–∫–ª–∞–¥ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–ª—é—á–∞:

```bash
# –í–∞—Ä—ñ–∞–Ω—Ç 1: –í–∏–ø–∞–¥–∫–æ–≤–∏–π hex –∫–ª—é—á (64 —Å–∏–º–≤–æ–ª–∏ = 32 bytes)
openssl rand -hex 32

# –í–∞—Ä—ñ–∞–Ω—Ç 2: –í–∏–ø–∞–¥–∫–æ–≤–∏–π base64 –∫–ª—é—á
openssl rand -base64 32

# –í–∞—Ä—ñ–∞–Ω—Ç 3: –í–∏–ø–∞–¥–∫–æ–≤–∏–π —Ç–µ–∫—Å—Ç–æ–≤–∏–π –∫–ª—é—á
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 3. –°—Ç–≤–æ—Ä–∏—Ç–∏ AWS S3 bucket

**–ß–µ—Ä–µ–∑ AWS CLI:**

```bash
aws s3 mb s3://your-bucket-name --region us-east-1
```

**–ß–µ—Ä–µ–∑ AWS Console:**

1. –í—ñ–¥–∫—Ä–∏–π [AWS S3 Console](https://s3.console.aws.amazon.com/)
2. –ù–∞—Ç–∏—Å–Ω–∏ "Create bucket"
3. –í–∫–∞–∂–∏ –Ω–∞–∑–≤—É bucket (–º–∞—î –±—É—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ)
4. –í–∏–±–µ—Ä–∏ —Ä–µ–≥—ñ–æ–Ω (—Ç–æ–π —Å–∞–º–∏–π, —â–æ –≤–∫–∞–∑–∞–Ω–æ –≤ `S3_REGION`)
5. –ù–∞–ª–∞—à—Ç—É–π –ø—É–±–ª—ñ—á–Ω–∏–π –¥–æ—Å—Ç—É–ø —Ç–∞ —ñ–Ω—à—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏
6. –°—Ç–≤–æ—Ä–∏ bucket

**–û—Ç—Ä–∏–º–∞—Ç–∏ AWS credentials:**

1. –í—ñ–¥–∫—Ä–∏–π [AWS IAM Console](https://console.aws.amazon.com/iam/)
2. –°—Ç–≤–æ—Ä–∏ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π —ñ—Å–Ω—É—é—á–æ–≥–æ)
3. –î–æ–¥–∞–π –ø–æ–ª—ñ—Ç–∏–∫—É –¥–æ—Å—Ç—É–ø—É –¥–æ S3 (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `AmazonS3FullAccess` –∞–±–æ –∫–∞—Å—Ç–æ–º–Ω—É)
4. –°—Ç–≤–æ—Ä–∏ Access Key ID —Ç–∞ Secret Access Key
5. –ó–±–µ—Ä–µ–∂–∏ credentials - –≤–æ–Ω–∏ –±—ñ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç—å –ø–æ–∫–∞–∑–∞–Ω—ñ!

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç

```bash
npm run dev
```

–í—ñ–¥–∫—Ä–∏–π [http://localhost:3000](http://localhost:3000)

---

## üîê –ë–µ–∑–ø–µ–∫–∞

- –§–∞–π–ª–∏ —à–∏—Ñ—Ä—É—é—Ç—å—Å—è –ø–µ—Ä–µ–¥ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è–º (AES-256-GCM)
- –ö–æ–∂–µ–Ω —Ñ–∞–π–ª –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è
- –ö–ª—é—á—ñ —Ñ–∞–π–ª—ñ–≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ master key (`FILE_ENCRYPTION_KEY`)
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ SHA-256 —Ö–µ—à—ñ
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∏–ø—ñ–≤ —Ç–∞ —Ä–æ–∑–º—ñ—Ä—ñ–≤ —Ñ–∞–π–ª—ñ–≤

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤ S3

–§–∞–π–ª–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ S3 bucket –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏:

- –§–æ—Ä–º–∞—Ç –∫–ª—é—á–∞: `{timestamp}-{random}.{extension}`
- –ü—Ä–∏–∫–ª–∞–¥: `1734544321000-abc123def456.jpg`

–§–∞–π–ª–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ –∑ —Ñ–æ—Ä–º–∞—Ç–æ–º: `IV (12 bytes) + authTag (16 bytes) + encrypted data`

**–í–∞–∂–ª–∏–≤–æ:** –£–±–µ–∑–ø–µ—á—Ç–µ S3 bucket:

- –ù–∞–ª–∞—à—Ç—É–π—Ç–µ bucket policy –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É
- –£–≤—ñ–º–∫–Ω—ñ—Ç—å –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- –ù–∞–ª–∞—à—Ç—É–π—Ç–µ lifecycle policies (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

---

## üöÄ –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏

1. –£–≤—ñ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É (–∞–±–æ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è)
2. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ 2FA (–æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø—ñ—Å–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó)
3. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª (drag & drop –∞–±–æ –∫–ª—ñ–∫)
4. –ü–æ–±–∞—á–∏—Ç–∏ —Ñ–∞–π–ª –≤ —Å–ø–∏—Å–∫—É
5. –°–∫–∞—á–∞—Ç–∏ —Ñ–∞–π–ª
6. –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª

---

---

## ‚ùì Troubleshooting

### –ü–æ–º–∏–ª–∫–∞: "FILE_ENCRYPTION_KEY is required"

- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –¥–æ–¥–∞–≤ `FILE_ENCRYPTION_KEY` –≤ `.env`
- –ö–ª—é—á –º–∞—î –±—É—Ç–∏ –º—ñ–Ω—ñ–º—É–º 32 —Å–∏–º–≤–æ–ª–∏

### –ü–æ–º–∏–ª–∫–∞: "File not found" –ø—Ä–∏ —Å–∫–∞—á—É–≤–∞–Ω–Ω—ñ

- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –º—ñ–≥—Ä–∞—Ü—ñ—è –ë–î –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∞
- –ü–µ—Ä–µ–≤—ñ—Ä, —á–∏ bucket —ñ—Å–Ω—É—î —ñ –¥–æ—Å—Ç—É–ø–Ω–∏–π
- –ü–µ—Ä–µ–≤—ñ—Ä S3 credentials (ACCESS_KEY_ID, SECRET_ACCESS_KEY)
- –ü–µ—Ä–µ–≤—ñ—Ä –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ bucket

### –§–∞–π–ª–∏ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è

- –ü–µ—Ä–µ–≤—ñ—Ä AWS S3 credentials (ACCESS_KEY_ID, SECRET_ACCESS_KEY)
- –ü–µ—Ä–µ–≤—ñ—Ä, —á–∏ bucket —ñ—Å–Ω—É—î —Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑ –≤–∞—à–æ–≥–æ —Ä–µ–≥—ñ–æ–Ω—É
- –ü–µ—Ä–µ–≤—ñ—Ä IAM –ø–æ–ª—ñ—Ç–∏–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ - –º–∞—é—Ç—å –±—É—Ç–∏ –ø—Ä–∞–≤–∞ –Ω–∞ `s3:PutObject`, `s3:GetObject`, `s3:DeleteObject`
- –ü–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ —Ä–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É –Ω–µ –ø–µ—Ä–µ–≤–∏—â—É—î 100MB
- –ü–µ—Ä–µ–≤—ñ—Ä, —á–∏ `S3_REGION` –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ä–µ–≥—ñ–æ–Ω—É bucket

### –ü–æ–º–∏–ª–∫–∞ Prisma Client

```bash
npx prisma generate
```

---

**–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä –º–æ–∂–µ—à —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ñ–∞–π–ª–æ–≤–µ —Å—Ö–æ–≤–∏—â–µ! üéâ**
